<script>

  var store = [
    {
      section: '#lp-pom-block-160',
      content: '#lp-pom-box-322',
      button: '#lp-pom-button-245'
    },
    {
      section: '#lp-pom-block-335',
      content: '#lp-pom-box-337',
      button: '#lp-pom-button-277'
    },
    {
      section: '#lp-pom-block-340',
      content: '#lp-pom-box-342',
      button: '#lp-pom-button-278'
    }
  ];

  var _visible;
  var _hidden;

  var setup = function (setup_obj) {

    console.log('Using setup_obj:', setup_obj)
    var toggleSection = $(setup_obj.section);   // Replace with ID of your collapsible page section
    var toggleContent = $(setup_obj.content);   // Replace with ID of box containing hidden/visible content
    var toggleButton = $(setup_obj.button);     // Replace with ID of button that toggles section

    var sectionHeight = $(toggleSection).height();        // Height of section to show/hide
    var toggleContentTop = toggleContent.position().top;  // Top value of content

    toggleSection.css("display", "none");
    toggleContent.css("display", "none");

    console.log('Set display:none; for ' + setup_obj.section + ' and ' + setup_obj.content)

    var otherSections = toggleSection.nextAll();
    var otherContent = toggleContent.siblings();
    console.log('otherContent', otherContent);
    console.log('otherSections', otherSections);

    var is_hidden = false;

    var moveStuff = function () {
      if (is_hidden) {
        for (var i = 0; i < otherContent.length; i++) {
          var content = $(otherContent[i]);
          var contentTop = content.position().top;
          //Is this element below toggleContent?
          if (contentTop > toggleContentTop) {
            var newTopValue = contentTop + sectionHeight;
            content.animate({top: "+=" + sectionHeight + "px"}, 600);
            console.log('newTopValue', newTopValue)
            console.log('Moved ', content)
          }
        }
        // TODO perhaps change these?
        $("#lp-pom-root, #lp-pom-root-color-overlay").height(function (index, height) {
          console.log(setup_obj.section + ' shown, adjusting height to ' + (height - sectionHeight))
          return (height - sectionHeight);
        });
        is_hidden = false;
        setup_obj.is_hidden = false;
        console.log('Setting is_hidden to false for ', setup_obj)
      } else {
        for (var i = 0; i < otherContent.length; i++) {
          var content = $(otherContent[i]);
          var contentTop = content.position().top;
          console.log('content', content)
          console.log('contentTop', contentTop)
          //Is this element below toggleContent?
          if (contentTop > toggleContentTop) {
            var newTopValue = content.position().top - sectionHeight;
            content.animate({top: "-=" + sectionHeight + "px"}, 600);
            console.log('newTopValue', newTopValue)
          }
        }
        $("#lp-pom-root, #lp-pom-root-color-overlay").height(function (index, height) {
          console.log(setup_obj.section + ' not shown, adjusting height to ' + (height - sectionHeight))
          return (height - sectionHeight);
        });
        is_hidden = true;
        setup_obj.is_hidden = true;
        console.log('Setting is_hidden to true for ', setup_obj)
      }
    }

    //Run moveStuff to adjust content on load
    moveStuff();

    toggleButton.click(function () { // ID of button/trigger
      if (_visible && _visible !== setup_obj.section) {
        $(_visible).hide()
        console.log('Hid section ' + _visible)
        updateHidden(_visible)
      }
      toggleSection.slideToggle('slow');
      toggleContent.slideToggle('slow');
      moveStuff();
      if (!is_hidden) {
        updateVisible(setup_obj.section)
      } else {
        updateHidden(setup_obj.section)
      }
      console.log('Current _visible section_id = ' + _visible)
      console.log('Current _hidden array = ', _hidden)
    });

  }

  /* Add all entries to hidden */
  var updateHidden = function (section_id) {
    _visible = null;
    _hidden = [];
    store.forEach(function (obj) {
      _hidden.push(obj.section)
    })
  }

  /* Add current section to _visible */
  var updateVisible = function (section_id) {
    _visible = section_id
    _hidden = [];

    store.forEach(function (obj) {
      if (obj.section !== _visible) {
        _hidden.push(obj.section)
      }
    })
  }

  store.forEach(function (setup_obj) {
    setup(setup_obj)
  })

</script>